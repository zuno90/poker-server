<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <script src="https://unpkg.com/colyseus.js@^0.14.0/dist/colyseus.js"></script>
  </head>
  <body>
    <script>
      window.onload = async () => {
        const client = new Colyseus.Client("ws://localhost:9000");

        const room = await client.joinOrCreate("noob", {
          jwt: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYzZWU2YzE5OTBlOGM2YWM1MjYwNWZjMCIsInVzZXJuYW1lIjoienVub2hhbiIsImlhdCI6MTY3NjU2OTYyOCwiZXhwIjoxNjc5MTYxNjI4fQ.frLdYfIsOeXm5_DOhPFgWML0UqzQUg91QH9v5QQGnd8",
        });

        room.onMessage("DEAL", (data) => {
          console.log("card:::::", data);
        });

        room.onMessage("FIRST_TURN", (data) => {
          console.log("first turn:::::", data);
        });

        room.onMessage("RANK", (data) => {
          console.log("rank:::::", data);
        });

        room.onMessage("RESULT", (data) => {
          console.log("result:::::", data);
        });

        room.onMessage("RESET_CD", (num) => {
          console.log("game has been reset after:::::", num);
        });

        room.onStateChange((state) => {
          console.log("the room state has been updated:", state);
        });

        async function handleRoom() {
          try {
            // room.onStateChange(state => {
            //   console.log(state.toJSON());
            // });
          } catch (error) {
            console.error(error);
          }
        }

        handleRoom();

        document
          .getElementById("start")
          .addEventListener("click", async function (event) {
            try {
              await room.send("START_GAME");
            } catch (e) {}
          });

        document
          .getElementById("raise")
          .addEventListener("click", async function (event) {
            try {
              await room.send("RAISE", { chips: 11000 });
            } catch (e) {}
          });
        document
          .getElementById("call")
          .addEventListener("click", async function (event) {
            try {
              await room.send("CALL");
            } catch (e) {}
          });
        document
          .getElementById("check")
          .addEventListener("click", async function (event) {
            try {
              await room.send("CHECK");
            } catch (e) {}
          });
        document
          .getElementById("allin")
          .addEventListener("click", async function (event) {
            try {
              await room.send("ALLIN");
            } catch (e) {}
          });
        document
          .getElementById("fold")
          .addEventListener("click", async function (event) {
            try {
              await room.send("FOLD");
            } catch (e) {}
          });
        document
          .getElementById("leave")
          .addEventListener("click", async function (event) {
            try {
              await room.leave();
            } catch (e) {}
          });
      };

      // async function callLogin() {
      //   const res = await fetch('http://localhost:9000/auth/signin', {
      //     headers: {
      //       Accept: 'application/json',
      //       'Content-Type': 'application/json',
      //     },
      //     method: 'POST',
      //     body: JSON.stringify({ username: 'test', password: 'test' }),
      //   });
      //   console.log(res);
      // }
      // callLogin();

      const arr = [0, 1, 4]; // co 3 ng
      console.log(arr[arr.length - 2]);
    </script>
    <div class="container is-max-widescreen">
      ZUNO TEST GAME CREATE
      <div class="buttons">
        <button class="button is-info" id="start">START</button>
        <button class="button is-success" id="raise">RAISE</button>
        <button class="button is-warning" id="call">CALL</button>
        <button class="button is-link" id="fold">FOLD</button>
        <button class="button is-primary" id="allin">ALLIN</button>
        <button class="button is-danger" id="check">CHECK</button>
        <button class="button is-danger" id="leave">LEAVE</button>
      </div>
    </div>
  </body>
</html>
